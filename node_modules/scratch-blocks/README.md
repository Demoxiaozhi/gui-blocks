# scratch-blocks
该项目基于[MIT的LLK部门的scratch-blocks项目](https://github.com/LLK/scratch-blocks)研发．

## 项目说明
开发负责人：SidneyGeng  
开发者：SidneyGeng, ZhiXu

## 开发者
### 分支介绍
该项目核心分支为master和develop分支，目前默认分支为develop分支，也是主要分支．该项目仍然处于早期阶段，**所有开发工作基于develop分支进行**，master分支暂时不维护．后续制定更详细的分支策略．  
说明：详细的git工作流程请参考树上科技推荐流程进行（issue + PR）．
### How to set up
1. 获取源码

    ```
git clone git@192.168.1.222:srcpi/scratch-blocks.git
cd scratch-blocks
    ```
2. 编译源码

    ```
python build.py
    ```
    如果直接运行，会有如下错误：  
    ```
Error: Closure not found.  Read this:
developers.google.com/blockly/guides/modify/web/closure
    ```
    scratch-blocks基于google blockly，依赖于closure项目，其代码也是closure风格．因此，编译需要安装对应的closure library和closure compiler，官方的版本使用在线的closure compiler service（google的服务，需翻墙）, 本项目已经修改build.py，使其使用本地的closure compiler工具进行编译．
从`smb://192.168.1.222/share/srcpi`获取`closure-library`和`closure-compiler-jar`，复制到scratch-blocks上层目录即可成功编译．
3. 运行

    在浏览器中打开`tests/vertical_playground.html`（不需要编译）即可．如果运行编译(压缩)版本，运行`test/vertical_playground_compressed.html`即可．

### 如何和upstream合并
说明：该部分一般由开发负责人完成，普通开发者也可以提交PR和upstream合并．
1. 添加远程仓库

    ```
git remote add upstream https://github.com/LLK/scratch-blocks.git
    ```
2. 切换到要操作的本地分支上
    
    ```
git checkout develop
    ```
3. 从upstream拉取最新代码

    ```
git fetch upstream
    ```
4. 将upstream/develop的代码合并到当前本地分支

    ```
git merge upstream/develop
    ```
    3和4相当于: `git pull upstream develop:develop`或`git pull upstream develop`  
    如果不在develop分支操作（本项目不允许直接在develop操作，操作无法push，详细操作参考issue+PR流程！），修改2即可．  
    （建议提交消息: Merge with upstream, Month/Date）

### npm操作
本项目基于webpack+npm管理,如果只是测试本项目功能,不需要使用npm即可,但是如果和其它项目结合,比如在scratch-gui中使用scratch-blocks,需要使用npm安装相应的开发依赖,并打开发布为node_modules模块,供scratch-gui使用.
1. 安装依赖

    ```
npm install
    ```
2. 发布

    ```
npm pack
    ```
    得到的tar.gz文件即为打包后的npm包内容,可以被scratch-gui项目引用.