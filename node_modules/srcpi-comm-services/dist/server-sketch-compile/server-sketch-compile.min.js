!function(n){function e(i){if(t[i])return t[i].exports;var c=t[i]={i:i,l:!1,exports:{}};return n[i].call(c.exports,c,c.exports,e),c.l=!0,c.exports}var t={};e.m=n,e.c=t,e.d=function(n,t,i){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:i})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=2)}([function(n,e){n.exports=require("child_process")},function(n,e){n.exports=require("path")},function(n,e,t){"use strict";function i(n,e){e.writeHead(200),e.end(c)}var c="1.0.0",o=t(3).createServer(i),l=t(4)(o),r=t(5);o.listen(55336),console.log("Server (sketch compile) started..."),process.on("SIGINT",function(){console.log("Caught interrupt signal"),process.exit()});var s={};process.on("exit",function(){for(var n in s){var e=s[n];for(var t in e)e[t].dispose()}}),l.on("connection",function(n){console.log("Connection from: "+n.id);var e=new r;s[n.id]=[e],n.on("disconnect",function(){console.log("disconnect"),e.dispose(),e=null,delete s[n.id]}),n.on("sketchCompile",function(t,i,c){e.sketch_compile(t,n,i,c)}),n.on("sketchCompileCancel",function(n){e.sketch_compile_cancel(n)})})},function(n,e){n.exports=require("http")},function(n,e){n.exports=require("socket.io")},function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=(t(6),t(7),t(0).fork),l=t(1),r=t(8),s=t(9),u=t(10),a="44e6a770-39d7-4b07-819b-8c46f8d03586",h=function(){function n(){i(this,n),this.childCompile=null,this._disposed=!1}return c(n,[{key:"sketch_compile",value:function(n,e,t,i){var c=this,h=n;e.emit("sketchCompileInfo","Start sketch compile...\n"),this.childCompile=o(l.join(__dirname,"./child-sketch-compiler.js"),[h,a],{silent:!0}),this.childCompile.stdout.on("data",function(n){process.stdout.write(n.toString()),e.emit("sketchCompileInfo",n.toString())}),this.childCompile.on("exit",function(n,t){if(c.childCompile=null,c._disposed)return i(null);if(0===n){e.emit("sketchCompileInfo","Sketch compile succesfully!\n");var o=l.join(u.homedir(),".bettertree",a,"sketch_build","sketch.ino.hex");s.readFile(o,{encoding:"utf8"},function(n,e){n?i(r.format("Sketch compile error: cannot read hex data!")):i(null,e)})}else i(r.format("Sketch compile error with exit code: %s, signal: %s!",n,t))})}},{key:"sketch_compile_cancel",value:function(n){if(this.childCompile){this.childCompile.on("exit",function(e,t){n(null)});try{this.childCompile.kill()}catch(n){}}else n(null)}},{key:"dispose",value:function(){this._disposed=!0,this.sketch_compile_cancel(function(){})}}]),n}();n.exports=h},function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=t(0).fork,l=t(1),r=function(){function n(e){i(this,n),console.log("Serial ctor..."),this.socket=e,this.inScan=!1,this.childInquiry=null,this.inConnect=!1,this.connectedDev=null,this.childConnect=null}return c(n,[{key:"isConnected",value:function(){return null!==this.connectedDev}},{key:"scan",value:function(){var n=this;this.scanStop(function(){n.inScan=!0,n.childInquiry=o(l.join(__dirname,"./usb-child-inquiry.js")),n.childInquiry.on("message",function(e){if("inquiry"===e.type);else if("error"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("usbInquiryFinished","Serial port is not working!")}else if("found"===e.type)n.socket.emit("usbInquiryFound",e.devices);else if("finished"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("usbInquiryFinished",e.value)}})})}},{key:"scanStop",value:function(n){this.inScan&&(this.inScan=!1,this.socket.emit("usbInquiryFinished",null));try{this.childInquiry.kill()}catch(n){}n(null)}},{key:"connect",value:function(n,e){var t=this,i=this;this.disconnect(function(){var c=!1,r=function(t){!1===c&&(null===t&&(i.connectedDev=Object.assign({},n),console.log("<- Event: usbConnected -"+JSON.stringify(n)),i.socket.emit("usbConnected",n)),i.inConnect=!1,c=!0,e(t))};t.inConnect=!0,t.childConnect=o(l.join(__dirname,"./usb-child-connect.js")),t.childConnect.send({cmd:"connect",arg:n}),t.childConnect.on("message",function(n){var e=n.type;if("data"===e){var i=new Buffer(n.value);t.socket.emit("usbReceived",i)}else if("connect"===e&&(r(n.err),n.err))try{t.childConnect.kill("SIGKILL")}catch(n){console.log(n)}}),t.childConnect.on("exit",function(n,e){i.connectedDev=null,!0===t.inConnect&&r("Error!"),console.log("<- Event: usbDisconnected"),t.socket.emit("usbDisconnected"),t.childConnect=null})})}},{key:"disconnect",value:function(n){if(this.childConnect){this.childConnect.on("exit",function(e,t){n(null)});try{this.childConnect.kill()}catch(n){}}else n(null)}},{key:"send",value:function(n,e){this.childConnect?(this.childConnect.send({cmd:"write",arg:n}),e(null)):e("Serial not connected!")}},{key:"dispose",value:function(){this.scanStop(function(){}),this.disconnect(function(){})}}]),n}();n.exports=r},function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=t(0).fork,l=t(1),r=function(){function n(e){i(this,n),console.log("Bluetooth ctor..."),this.socket=e,this.inScan=!1,this.childInquiry=null,this.inConnect=!1,this.connectedDev=null,this.childConnect=null,this.childClear=null}return c(n,[{key:"isConnected",value:function(){return null!==this.connectedDev}},{key:"scan",value:function(){var n=this;this.scanStop(function(){n.inScan=!0,n.childInquiry=o(l.join(__dirname,"./bt-child-inquiry.js")),n.childInquiry.on("message",function(e){if("inquiry"===e.type);else if("error"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("btInquiryFinished","Bluetooth is not working!")}else if("found"===e.type)n.socket.emit("btInquiryFound",[{name:e.name,addr:e.addr,channel:e.channel}]);else if("finished"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("btInquiryFinished",e.value)}})})}},{key:"scanStop",value:function(n){this.inScan&&(this.inScan=!1,this.socket.emit("btInquiryFinished",null));try{this.childInquiry.kill()}catch(n){}n(null)}},{key:"connect",value:function(n,e){var t=this,i=this;this.disconnect(function(){var c=!1,r=function(t){!1===c&&(null===t&&(i.connectedDev=Object.assign({},n),i.socket.emit("btConnected",n)),i.inConnect=!1,c=!0,e(t))};t.inConnect=!0,t.childConnect=o(l.join(__dirname,"./bt-child-connect.js")),t.childConnect.send({cmd:"connect",arg:n}),t.childConnect.on("message",function(n){var e=n.type;if("data"===e){var i=new Buffer(n.value);t.socket.emit("btReceived",i)}else if("connect"===e&&(r(n.err),n.err))try{t.childConnect.kill()}catch(n){}}),t.childConnect.on("exit",function(n,e){i.connectedDev=null,!0===t.inConnect&&r("Error"),t.socket.emit("btDisconnected"),t.childConnect=null})})}},{key:"disconnect",value:function(n){if(this.childConnect){this.childConnect.on("exit",function(e,t){n(null)});try{this.childConnect.kill()}catch(n){}}else n(null)}},{key:"send",value:function(n,e){this.childConnect?(this.childConnect.send({cmd:"write",arg:n}),e(null)):e("Bluetooth not connected!")}},{key:"dispose",value:function(){this.scanStop(function(){}),this.disconnect(function(){})}}]),n}();n.exports=r},function(n,e){n.exports=require("util")},function(n,e){n.exports=require("fs")},function(n,e){n.exports=require("os")}]);