!function(n){function e(i){if(t[i])return t[i].exports;var c=t[i]={i:i,l:!1,exports:{}};return n[i].call(c.exports,c,c.exports,e),c.l=!0,c.exports}var t={};e.m=n,e.c=t,e.d=function(n,t,i){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:i})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=4)}([function(n,e){n.exports=require("child_process")},function(n,e){n.exports=require("path")},function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=t(0).fork,l=t(1),s=function(){function n(e){i(this,n),console.log("Serial ctor..."),this.socket=e,this.inScan=!1,this.childInquiry=null,this.inConnect=!1,this.connectedDev=null,this.childConnect=null}return c(n,[{key:"isConnected",value:function(){return null!==this.connectedDev}},{key:"scan",value:function(){var n=this;this.scanStop(function(){n.inScan=!0,n.childInquiry=o(l.join(__dirname,"./usb-child-inquiry.js")),n.childInquiry.on("message",function(e){if("inquiry"===e.type);else if("error"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("usbInquiryFinished","Serial port is not working!")}else if("found"===e.type)n.socket.emit("usbInquiryFound",e.devices);else if("finished"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("usbInquiryFinished",e.value)}})})}},{key:"scanStop",value:function(n){this.inScan&&(this.inScan=!1,this.socket.emit("usbInquiryFinished",null));try{this.childInquiry.kill()}catch(n){}n(null)}},{key:"connect",value:function(n,e){var t=this,i=this;this.disconnect(function(){var c=!1,s=function(t){!1===c&&(null===t&&(i.connectedDev=Object.assign({},n),console.log("<- Event: usbConnected -"+JSON.stringify(n)),i.socket.emit("usbConnected",n)),i.inConnect=!1,c=!0,e(t))};t.inConnect=!0,t.childConnect=o(l.join(__dirname,"./usb-child-connect.js")),t.childConnect.send({cmd:"connect",arg:n}),t.childConnect.on("message",function(n){var e=n.type;if("data"===e){var i=new Buffer(n.value);t.socket.emit("usbReceived",i)}else if("connect"===e&&(s(n.err),n.err))try{t.childConnect.kill("SIGKILL")}catch(n){console.log(n)}}),t.childConnect.on("exit",function(n,e){i.connectedDev=null,!0===t.inConnect&&s("Error!"),console.log("<- Event: usbDisconnected"),t.socket.emit("usbDisconnected"),t.childConnect=null})})}},{key:"disconnect",value:function(n){if(this.childConnect){this.childConnect.on("exit",function(e,t){n(null)});try{this.childConnect.kill()}catch(n){}}else n(null)}},{key:"send",value:function(n,e){this.childConnect?(this.childConnect.send({cmd:"write",arg:n}),e(null)):e("Serial not connected!")}},{key:"dispose",value:function(){this.scanStop(function(){}),this.disconnect(function(){})}}]),n}();n.exports=s},function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=t(0).fork,l=t(1),s=function(){function n(e){i(this,n),console.log("Bluetooth ctor..."),this.socket=e,this.inScan=!1,this.childInquiry=null,this.inConnect=!1,this.connectedDev=null,this.childConnect=null,this.childClear=null}return c(n,[{key:"isConnected",value:function(){return null!==this.connectedDev}},{key:"scan",value:function(){var n=this;this.scanStop(function(){n.inScan=!0,n.childInquiry=o(l.join(__dirname,"./bt-child-inquiry.js")),n.childInquiry.on("message",function(e){if("inquiry"===e.type);else if("error"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("btInquiryFinished","Bluetooth is not working!")}else if("found"===e.type)n.socket.emit("btInquiryFound",[{name:e.name,addr:e.addr,channel:e.channel}]);else if("finished"===e.type){try{n.childInquiry.kill()}catch(n){}n.inScan=!1,n.socket.emit("btInquiryFinished",e.value)}})})}},{key:"scanStop",value:function(n){this.inScan&&(this.inScan=!1,this.socket.emit("btInquiryFinished",null));try{this.childInquiry.kill()}catch(n){}n(null)}},{key:"connect",value:function(n,e){var t=this,i=this;this.disconnect(function(){var c=!1,s=function(t){!1===c&&(null===t&&(i.connectedDev=Object.assign({},n),i.socket.emit("btConnected",n)),i.inConnect=!1,c=!0,e(t))};t.inConnect=!0,t.childConnect=o(l.join(__dirname,"./bt-child-connect.js")),t.childConnect.send({cmd:"connect",arg:n}),t.childConnect.on("message",function(n){var e=n.type;if("data"===e){var i=new Buffer(n.value);t.socket.emit("btReceived",i)}else if("connect"===e&&(s(n.err),n.err))try{t.childConnect.kill()}catch(n){}}),t.childConnect.on("exit",function(n,e){i.connectedDev=null,!0===t.inConnect&&s("Error"),t.socket.emit("btDisconnected"),t.childConnect=null})})}},{key:"disconnect",value:function(n){if(this.childConnect){this.childConnect.on("exit",function(e,t){n(null)});try{this.childConnect.kill()}catch(n){}}else n(null)}},{key:"send",value:function(n,e){this.childConnect?(this.childConnect.send({cmd:"write",arg:n}),e(null)):e("Bluetooth not connected!")}},{key:"dispose",value:function(){this.scanStop(function(){}),this.disconnect(function(){})}}]),n}();n.exports=s},function(n,e,t){"use strict";function i(n,e){e.writeHead(200),e.end(c)}var c="1.0.0",o=t(5).createServer(i),l=t(6)(o),s=t(2),u=t(3),r=t(7);o.listen(55335),console.log("Server started..."),process.on("SIGINT",function(){console.log("Caught interrupt signal"),process.exit()});var a={};process.on("exit",function(){for(var n in a){var e=a[n];for(var t in e)e[t].dispose()}}),l.on("connection",function(n){console.log("Connection from: "+n.id);var e=new s(n),t=new u(n),i=new r;a[n.id]=[e,t,i],n.on("disconnect",function(){console.log("disconnect"),e.dispose(),t.dispose(),i.dispose(),e=null,t=null,i=null,delete a[n.id]}),n.on("usbInquiry",function(){e.scan()}),n.on("usbInquiryStop",function(n){e.scanStop(n)}),n.on("usbConnect",function(n,i){console.log("-> Event: usbConnect - "+JSON.stringify(n)),t.disconnect(function(){e.connect(n,i)})}),n.on("usbDisconnect",function(n){console.log("-> Event: usbDisconnect"),e.disconnect(n)}),n.on("btInquiry",function(){t.scan()}),n.on("btInquiryStop",function(n){t.scanStop(n)}),n.on("btConnect",function(n,i){console.log("Event: btConnect - "+JSON.stringify(n)),e.disconnect(function(){t.connect(n,i)})}),n.on("btDisconnect",function(n){console.log("Event: btDisconnect"),t.disconnect(n)}),n.on("sendPackage",function(n,i){e.isConnected()?e.send(n,function(n){i(n?"No connection!":null)}):t.send(n,function(n){i(n?"No connection!":null)})}),n.on("fmInstall",function(n,c){e.isConnected()?i.fm_install(e,n,c):t.isConnected()?i.fm_install(t,n,c):c("No connection!")}),n.on("fmInstallCancel",function(n){i.fm_install_cancel(n)}),n.on("sketchUpload",function(n,c,o){e.isConnected()?i.sketch_upload(n,e,c,o):t.isConnected()?i.sketch_upload(n,t,c,o):o("No connection!")}),n.on("sketchUploadCancel",function(n){i.sketch_upload_cancel(n)})})},function(n,e){n.exports=require("http")},function(n,e){n.exports=require("socket.io")},function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=t(2),l=(t(3),t(0).fork),s=t(1),u=t(8),r=t(9),a=function(){function n(){i(this,n),this.inUpload=!1,this.childUpload=null,this._disposed=!1}return c(n,[{key:"fm_install_cancel",value:function(n){this.sketch_upload_cancel(n)}},{key:"fm_install",value:function(n,e,t){var i=this,c=s.join(__dirname,"firmwares",e.name,"fm.hex");r.readFile(c,{encoding:"utf8"},function(c,o){c?t(c):i.sketch_upload(o,n,e,t)})}},{key:"sketch_upload_cancel",value:function(n){if(this.childUpload){this.childUpload.on("exit",function(e,t){n(null)});try{this.childUpload.kill()}catch(n){}}else n(null)}},{key:"sketch_upload",value:function(n,e,t,i){var c,r,a,d=this,f=Object.assign({},e.connectedDev);e instanceof o?(c=0,r=f.comName,a=f.baud):(c=1,r=f.addr,a=f.channel),e.disconnect(function(){d.inUpload=!0,d.childUpload=l(s.join(__dirname,"./child-stk500-uploader"),[0,"ignore",c,r,a],{silent:!0});try{d.childUpload.stdin.write(n),d.childUpload.stdin.end()}catch(n){return void d.sketch_upload_cancel(function(){d.childUpload=null,i("Invalid hex data!")})}d.childUpload.stdout.on("data",function(n){process.stdout.write(n.toString()),e.socket.emit("sketchUploadInfo",n.toString())}),d.childUpload.on("exit",function(n,t){if(d.childUpload=null,d._disposed)return i(null);e.connect(f,function(e){i(0===n?null:u.format("Upload error with exit code: %s, signal: %s!",n,t))})})})}},{key:"dispose",value:function(){this._disposed=!0,this.sketch_upload_cancel(function(){})}}]),n}();n.exports=a},function(n,e){n.exports=require("util")},function(n,e){n.exports=require("fs")}]);